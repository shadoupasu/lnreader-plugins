var e=this&&this.__awaiter||function(e,t,r,n){return new(r||(r=Promise))((function(a,s){function o(e){try{i(n.next(e))}catch(e){s(e)}}function l(e){try{i(n.throw(e))}catch(e){s(e)}}function i(e){var t;e.done?a(e.value):(t=e.value,t instanceof r?t:new r((function(e){e(t)}))).then(o,l)}i((n=n.apply(e,t||[])).next())}))},t=this&&this.__generator||function(e,t){var r,n,a,s={label:0,sent:function(){if(1&a[0])throw a[1];return a[1]},trys:[],ops:[]},o=Object.create(("function"==typeof Iterator?Iterator:Object).prototype);return o.next=l(0),o.throw=l(1),o.return=l(2),"function"==typeof Symbol&&(o[Symbol.iterator]=function(){return this}),o;function l(l){return function(i){return function(l){if(r)throw new TypeError("Generator is already executing.");for(;o&&(o=0,l[0]&&(s=0)),s;)try{if(r=1,n&&(a=2&l[0]?n.return:l[0]?n.throw||((a=n.return)&&a.call(n),0):n.next)&&!(a=a.call(n,l[1])).done)return a;switch(n=0,a&&(l=[2&l[0],a.value]),l[0]){case 0:case 1:a=l;break;case 4:return s.label++,{value:l[1],done:!1};case 5:s.label++,n=l[1],l=[0];continue;case 7:l=s.ops.pop(),s.trys.pop();continue;default:if(!(a=s.trys,(a=a.length>0&&a[a.length-1])||6!==l[0]&&2!==l[0])){s=0;continue}if(3===l[0]&&(!a||l[1]>a[0]&&l[1]<a[3])){s.label=l[1];break}if(6===l[0]&&s.label<a[1]){s.label=a[1],a=l;break}if(a&&s.label<a[2]){s.label=a[2],s.ops.push(l);break}a[2]&&s.ops.pop(),s.trys.pop();continue}l=t.call(e,s)}catch(e){l=[6,e],n=0}finally{r=a=0}if(5&l[0])throw l[1];return{value:l[0]?l[1]:void 0,done:!0}}([l,i])}}};Object.defineProperty(exports,"__esModule",{value:!0});var r=require("@libs/fetch"),n=require("@libs/filterInputs"),a=require("@libs/defaultCover"),s=require("@libs/novelStatus"),o=function(){function o(){var e=this;this.id="novelrest",this.name="NovelRest",this.icon="src/en/novelrest/icon.png",this.site="https://novelrest.vercel.app",this.apiBase="https://novelrest.vercel.app/api/lnreader",this.version="1.0.0",this.filters={status:{type:n.FilterTypes.Picker,label:"Status",value:"",options:[{label:"All",value:""},{label:"Ongoing",value:"ONGOING"},{label:"Completed",value:"COMPLETED"},{label:"Hiatus",value:"HIATUS"}]},sort:{type:n.FilterTypes.Picker,label:"Sort By",value:"latest",options:[{label:"Latest",value:"latest"},{label:"Popular",value:"popular"},{label:"Rating",value:"rating"},{label:"Updated",value:"updated"}]}},this.resolveUrl=function(t,r){return"".concat(e.site,"/novels/").concat(t)}}return o.prototype.popularNovels=function(n,s){return e(this,arguments,void 0,(function(e,n){var s,o,l,i,c,u,p,v,h,f,b,d=n.showLatestNovels,y=n.filters;return t(this,(function(t){switch(t.label){case 0:s=[],(o=new URLSearchParams).set("page",e.toString()),o.set("limit","20"),(null===(f=null==y?void 0:y.status)||void 0===f?void 0:f.value)&&o.set("status",y.status.value),l=d?"latest":(null===(b=null==y?void 0:y.sort)||void 0===b?void 0:b.value)||"popular",o.set("sort",l),t.label=1;case 1:return t.trys.push([1,4,,5]),i="".concat(this.apiBase,"/novels?").concat(o.toString()),[4,(0,r.fetchApi)(i)];case 2:return[4,t.sent().json()];case 3:if((c=t.sent()).novels&&Array.isArray(c.novels))for(u=0,p=c.novels;u<p.length;u++)v=p[u],s.push({name:v.title,path:v.slug,cover:v.coverImage||a.defaultCover});return[3,5];case 4:return h=t.sent(),console.error("NovelRest: Error fetching popular novels:",h),[3,5];case 5:return[2,s]}}))}))},o.prototype.parseNovel=function(n){return e(this,void 0,void 0,(function(){var e,o,l,i,c,u,p,v;return t(this,(function(t){switch(t.label){case 0:e={path:n,name:"Untitled"},t.label=1;case 1:return t.trys.push([1,4,,5]),o=n.replace(/^\/novels\//,""),[4,(0,r.fetchApi)("".concat(this.apiBase,"/novels/").concat(o))];case 2:return[4,t.sent().json()];case 3:if(l=t.sent()){switch(e.name=l.title||"Untitled",e.author=l.author||"",e.cover=l.coverImage||a.defaultCover,e.genres=Array.isArray(l.genres)?l.genres.map((function(e){return"string"==typeof e?e:e.name})).join(", "):"",e.summary=l.description||"",l.status){case"COMPLETED":e.status=s.NovelStatus.Completed;break;case"ONGOING":e.status=s.NovelStatus.Ongoing;break;case"HIATUS":e.status=s.NovelStatus.OnHiatus;break;default:e.status=s.NovelStatus.Unknown}if(i=[],l.chapters&&Array.isArray(l.chapters))for(c=0,u=l.chapters;c<u.length;c++)p=u[c],i.push({name:p.title||"Chapter ".concat(p.number),path:"".concat(o,"/").concat(p.number),releaseTime:p.createdAt||void 0,chapterNumber:p.number});e.chapters=i}return[3,5];case 4:return v=t.sent(),console.error("NovelRest: Error parsing novel:",v),[3,5];case 5:return[2,e]}}))}))},o.prototype.parseChapter=function(n){return e(this,void 0,void 0,(function(){var e,a,s,o,l;return t(this,(function(t){switch(t.label){case 0:return t.trys.push([0,3,,4]),e=n.split("/"),a=e.pop(),s=e.join("/"),[4,(0,r.fetchApi)("".concat(this.apiBase,"/novels/").concat(s,"/chapters/").concat(a))];case 1:return[4,t.sent().json()];case 2:return(o=t.sent())&&o.contentHtml?[2,o.contentHtml]:[2,"<p>Chapter content could not be loaded.</p>"];case 3:return l=t.sent(),console.error("NovelRest: Error parsing chapter:",l),[2,"<p>Error loading chapter content.</p>"];case 4:return[2]}}))}))},o.prototype.searchNovels=function(n,s){return e(this,void 0,void 0,(function(){var e,o,l,i,c,u,p;return t(this,(function(t){switch(t.label){case 0:e=[],t.label=1;case 1:return t.trys.push([1,4,,5]),(o=new URLSearchParams).set("q",n),o.set("page",s.toString()),o.set("limit","20"),[4,(0,r.fetchApi)("".concat(this.apiBase,"/novels?").concat(o.toString()))];case 2:return[4,t.sent().json()];case 3:if((l=t.sent()).novels&&Array.isArray(l.novels))for(i=0,c=l.novels;i<c.length;i++)u=c[i],e.push({name:u.title,path:u.slug,cover:u.coverImage||a.defaultCover});return[3,5];case 4:return p=t.sent(),console.error("NovelRest: Error searching novels:",p),[3,5];case 5:return[2,e]}}))}))},o}();exports.default=new o;